### Local Setup

- execute `npm install`
- copy `.env.example` as `.env`
- update env variables
- execute `npm run start`

### Build

```
source .env
docker build -t gcr.io/visualexp-a7d2c/sitemap-scheduler \
	--build-arg=ONECADEMYCRED_TYPE="$${ONECADEMYCRED_TYPE}" \
	--build-arg=ONECADEMYCRED_PROJECT_ID="$${ONECADEMYCRED_PROJECT_ID}" \
	--build-arg=ONECADEMYCRED_PRIVATE_KEY_ID="$${ONECADEMYCRED_PRIVATE_KEY_ID}" \
	--build-arg=ONECADEMYCRED_PRIVATE_KEY="$${ONECADEMYCRED_PRIVATE_KEY}" \
	--build-arg=ONECADEMYCRED_CLIENT_EMAIL="$${ONECADEMYCRED_CLIENT_EMAIL}" \
	--build-arg=ONECADEMYCRED_CLIENT_ID="$${ONECADEMYCRED_CLIENT_ID}" \
	--build-arg=ONECADEMYCRED_AUTH_URI="$${ONECADEMYCRED_AUTH_URI}" \
	--build-arg=ONECADEMYCRED_TOKEN_URI="$${ONECADEMYCRED_TOKEN_URI}" \
	--build-arg=ONECADEMYCRED_AUTH_PROVIDER_X509_CERT_URL="$${ONECADEMYCRED_AUTH_PROVIDER_X509_CERT_URL}" \
	--build-arg=ONECADEMYCRED_CLIENT_X509_CERT_URL="$${ONECADEMYCRED_CLIENT_X509_CERT_URL}" \
	--build-arg=GCSTORAGE_TYPE="$${GCSTORAGE_TYPE}" \
	--build-arg=GCSTORAGE_PROJECT_ID="$${GCSTORAGE_PROJECT_ID}" \
	--build-arg=GCSTORAGE_PRIVATE_KEY_ID="$${GCSTORAGE_PRIVATE_KEY_ID}" \
	--build-arg=GCSTORAGE_PRIVATE_KEY="$${GCSTORAGE_PRIVATE_KEY}" \
	--build-arg=GCSTORAGE_CLIENT_EMAIL="$${GCSTORAGE_CLIENT_EMAIL}" \
	--build-arg=GCSTORAGE_CLIENT_ID="$${GCSTORAGE_CLIENT_ID}" \
	--build-arg=GCSTORAGE_AUTH_URI="$${GCSTORAGE_AUTH_URI}" \
	--build-arg=GCSTORAGE_TOKEN_URI="$${GCSTORAGE_TOKEN_URI}" \
	--build-arg=GCSTORAGE_AUTH_PROVIDER_X509_CERT_URL="$${GCSTORAGE_AUTH_PROVIDER_X509_CERT_URL}" \
	--build-arg=GCSTORAGE_CLIENT_X509_CERT_URL="$${GCSTORAGE_CLIENT_X509_CERT_URL}" \
	--build-arg=STATIC_STORAGE_BUCKET="$${STATIC_STORAGE_BUCKET}" \
	--build-arg=NEXT_PUBLIC_DATA_BASE_URL="$${NEXT_PUBLIC_DATA_BASE_URL}" \
	--build-arg=NEXT_PUBLIC_PROJECT_ID="$${NEXT_PUBLIC_PROJECT_ID}" \
	--build-arg=APP_URL="$${APP_URL}" .
```

### Push

```
# optional command to authorize your push requests
gcloud auth login
gcloud auth configure-docker

# required command to push image
docker push gcr.io/visualexp-a7d2c/sitemap-scheduler:latest
```

### Deploy

```
gcloud beta run jobs create sitemap-generator --image=gcr.io/visualexp-a7d2c/sitemap-scheduler --set-env-vars=ONECADEMYCRED_TYPE="${ONECADEMYCRED_TYPE}",ONECADEMYCRED_PROJECT_ID="${ONECADEMYCRED_PROJECT_ID}",ONECADEMYCRED_PRIVATE_KEY_ID="${ONECADEMYCRED_PRIVATE_KEY_ID}",ONECADEMYCRED_PRIVATE_KEY="${ONECADEMYCRED_PRIVATE_KEY}",ONECADEMYCRED_CLIENT_EMAIL="${ONECADEMYCRED_CLIENT_EMAIL}",ONECADEMYCRED_CLIENT_ID="${ONECADEMYCRED_CLIENT_ID}",ONECADEMYCRED_AUTH_URI="${ONECADEMYCRED_AUTH_URI}",ONECADEMYCRED_TOKEN_URI="${ONECADEMYCRED_TOKEN_URI}",ONECADEMYCRED_AUTH_PROVIDER_X509_CERT_URL="${ONECADEMYCRED_AUTH_PROVIDER_X509_CERT_URL}",ONECADEMYCRED_CLIENT_X509_CERT_URL="${ONECADEMYCRED_CLIENT_X509_CERT_URL}",GCSTORAGE_TYPE="${GCSTORAGE_TYPE}",GCSTORAGE_PROJECT_ID="${GCSTORAGE_PROJECT_ID}",GCSTORAGE_PRIVATE_KEY_ID="${GCSTORAGE_PRIVATE_KEY_ID}",GCSTORAGE_PRIVATE_KEY="${GCSTORAGE_PRIVATE_KEY}",GCSTORAGE_CLIENT_EMAIL="${GCSTORAGE_CLIENT_EMAIL}",GCSTORAGE_CLIENT_ID="${GCSTORAGE_CLIENT_ID}",GCSTORAGE_AUTH_URI="${GCSTORAGE_AUTH_URI}",GCSTORAGE_TOKEN_URI="${GCSTORAGE_TOKEN_URI}",GCSTORAGE_AUTH_PROVIDER_X509_CERT_URL="${GCSTORAGE_AUTH_PROVIDER_X509_CERT_URL}",GCSTORAGE_CLIENT_X509_CERT_URL="${GCSTORAGE_CLIENT_X509_CERT_URL}",STATIC_STORAGE_BUCKET="${STATIC_STORAGE_BUCKET}",NEXT_PUBLIC_DATA_BASE_URL="${NEXT_PUBLIC_DATA_BASE_URL}",NEXT_PUBLIC_PROJECT_ID="${NEXT_PUBLIC_PROJECT_ID}",APP_URL="${APP_URL}"
```

### To execute manually

```
gcloud beta run jobs execute sitemap-generator
```
